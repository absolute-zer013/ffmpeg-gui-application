#!/usr/bin/env bash
set -euo pipefail

# Git pre-push hook: run local test suite before allowing push
# This uses the repo's PowerShell script when available; otherwise falls back to `flutter test`.

REPO_ROOT="$(git rev-parse --show-toplevel)"
SCRIPT_PS="$REPO_ROOT/scripts/run_tests.ps1"

if command -v pwsh >/dev/null 2>&1; then
  pwsh -NoProfile -ExecutionPolicy Bypass -File "$SCRIPT_PS" all
elif command -v powershell >/dev/null 2>&1; then
  powershell -NoProfile -ExecutionPolicy Bypass -File "$SCRIPT_PS" all
else
  echo "PowerShell not found; running 'flutter test' fallback" >&2
  (cd "$REPO_ROOT" && flutter test)
fi

echo "Pre-push checks passed. Proceeding with push."
